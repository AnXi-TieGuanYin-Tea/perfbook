% locking/locking.tex

\QuickQuizChapter{chp:Locking}{Locking}

The role of villain in much of the past few decades' concurrency research
literature is played by locking,
which stands accused of promoting deadlocks, convoying, starvation,
unfairness, data races, and all manner of other concurrency sins.
Interestingly enough, the role of workhorse in shared-memory parallel
software is played by, you guessed it, locking.

There are a number of reasons behind this dichotomy:

\begin{enumerate}
\item	Many of locking's sins have pragmatic design solutions that
	work well in most cases, for example:
	\begin{enumerate}
	\item	Lock hierarchies to avoid deadlock.
	\item	Deadlock-detection tools.
	\item	Locking-friendly data structures, such as
		arrays, hash tables, and radix trees.
	\end{enumerate}
\item	Some of locking's sins are problems only at high levels of
	contention, levels that are usually reached only by poorly
	designed programs.
\item	Some of locking's sins are avoided by using other synchronization
	mechanisms in concert with locking, such as reference counters,
	statistical counters, simple non-blocking data structures, and RCU.
\item	Until quite recently, almost all large shared-memory parallel
	programs were developed in secret, so that it was difficult for
	most researchers to learn of these pragmatic solutions.
\item	All good stories need a villain, and locking has a long and
	honorable history serving as a research-paper whipping boy.
\end{enumerate}

This chapter will give an overview of a number of ways to avoid locking's
more serious sins.

% @@CARTOON@@ animated lock with black hat, curly moustache, evil grin

\section{Staying Alive}
\label{sec:locking:Staying Alive}

\subsection{Deadlock}
\label{sec:locking:Deadlock}

\subsection{Livelock}
\label{sec:locking:Livelock}

\subsection{Starvation}
\label{sec:locking:Starvation}

\subsection{Unfairness}
\label{sec:locking:Unfairness}

\subsection{Inefficiency}
\label{sec:locking:Inefficiency}

\section{Types of Locks}
\label{sec:locking:Types of Locks}

\subsection{Exclusive Locks}
\label{sec:locking:Exclusive Locks}

\subsection{Reader-Writer Locks}
\label{sec:locking:Reader-Writer Locks}

\subsection{Beyond Reader-Writer Locks}
\label{sec:locking:Beyond Reader-Writer Locks}

Sequence locks.  VAXCluster six-state locking.

\subsection{While Waiting}
\label{sec:locking:While Waiting}

Spinlocks, sleeplocks, spin-sleeplocks (maybe), conditional locking.

\subsection{Sleeping Safely}
\label{sec:locking:Sleeping Safely}

\input{locking/locking-existence}
